import{s as ge,f as d,a as I,l as Z,e as he,g as h,h as v,r as te,c as N,d as o,m as Q,j as r,i as H,u as a,v as se,n as X,w as ie,x as Pe,y as be,z as ue,A as ce,B as Le,C as De,D as Re,p as Je,E as qe,F as Ge,G as Ke,H as Ze,I as Qe,o as We}from"../chunks/scheduler.a1aa4b3e.js";import{S as ke,i as ye,f as Xe,b as xe,d as Ce,m as Be,a as ve,t as _e,e as Ie}from"../chunks/index.e0a59431.js";function me(l){return(l==null?void 0:l.length)!==void 0?l:Array.from(l)}function Ne(l,e,t){const s=l.slice();return s[6]=e[t],s}function Ae(l,e,t){const s=l.slice();return s[6]=e[t],s}function Ve(l){let e,t,s=l[6].icon+"",n,u,c=l[6].name+"",_,b,f;return{c(){e=d("a"),t=d("span"),n=Z(s),u=I(),_=Z(c),b=I(),this.h()},l(k){e=h(k,"A",{href:!0,class:!0});var i=v(e);t=h(i,"SPAN",{class:!0});var E=v(t);n=Q(E,s),E.forEach(o),u=N(i),_=Q(i,c),b=N(i),i.forEach(o),this.h()},h(){r(t,"class","mr-1"),r(e,"href",f=l[6].href),r(e,"class","inline-flex items-center px-1 pt-1 text-sm font-medium text-gray-500 hover:text-gray-700 hover:border-gray-300 transition-colors duration-200")},m(k,i){H(k,e,i),a(e,t),a(t,n),a(e,u),a(e,_),a(e,b)},p(k,i){i&8&&s!==(s=k[6].icon+"")&&X(n,s),i&8&&c!==(c=k[6].name+"")&&X(_,c),i&8&&f!==(f=k[6].href)&&r(e,"href",f)},d(k){k&&o(e)}}}function Oe(l){let e,t,s,n,u=(l[1]||"用户")+"",c,_,b,f,k,i,E="个人设置",F,m,M="退出登录",B,p;return{c(){e=d("div"),t=d("div"),s=d("div"),n=d("div"),c=Z(u),_=I(),b=d("div"),f=Z(l[0]),k=I(),i=d("a"),i.textContent=E,F=I(),m=d("button"),m.textContent=M,this.h()},l(V){e=h(V,"DIV",{class:!0});var L=v(e);t=h(L,"DIV",{class:!0});var T=v(t);s=h(T,"DIV",{class:!0});var z=v(s);n=h(z,"DIV",{class:!0});var R=v(n);c=Q(R,u),R.forEach(o),_=N(z),b=h(z,"DIV",{class:!0});var P=v(b);f=Q(P,l[0]),P.forEach(o),z.forEach(o),k=N(T),i=h(T,"A",{href:!0,class:!0,"data-svelte-h":!0}),te(i)!=="svelte-wtfym5"&&(i.textContent=E),F=N(T),m=h(T,"BUTTON",{class:!0,"data-svelte-h":!0}),te(m)!=="svelte-1taqmdf"&&(m.textContent=M),T.forEach(o),L.forEach(o),this.h()},h(){r(n,"class","font-medium"),r(b,"class","text-xs text-gray-500 capitalize"),r(s,"class","px-4 py-2 text-sm text-gray-700 border-b border-gray-100"),r(i,"href","/profile"),r(i,"class","block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"),r(m,"class","block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"),r(t,"class","py-1"),r(e,"class","origin-top-right absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 z-50")},m(V,L){H(V,e,L),a(e,t),a(t,s),a(s,n),a(n,c),a(s,_),a(s,b),a(b,f),a(t,k),a(t,i),a(t,F),a(t,m),B||(p=se(m,"click",He),B=!0)},p(V,L){L&2&&u!==(u=(V[1]||"用户")+"")&&X(c,u),L&1&&X(f,V[0])},d(V){V&&o(e),B=!1,p()}}}function Ye(l){let e,t;return{c(){e=ue("svg"),t=ue("path"),this.h()},l(s){e=ce(s,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0,stroke:!0});var n=v(e);t=ce(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(t).forEach(o),n.forEach(o),this.h()},h(){r(t,"stroke-linecap","round"),r(t,"stroke-linejoin","round"),r(t,"stroke-width","2"),r(t,"d","M6 18L18 6M6 6l12 12"),r(e,"class","block h-6 w-6"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24"),r(e,"stroke","currentColor")},m(s,n){H(s,e,n),a(e,t)},d(s){s&&o(e)}}}function $e(l){let e,t;return{c(){e=ue("svg"),t=ue("path"),this.h()},l(s){e=ce(s,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0,stroke:!0});var n=v(e);t=ce(n,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),v(t).forEach(o),n.forEach(o),this.h()},h(){r(t,"stroke-linecap","round"),r(t,"stroke-linejoin","round"),r(t,"stroke-width","2"),r(t,"d","M4 6h16M4 12h16M4 18h16"),r(e,"class","block h-6 w-6"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24"),r(e,"stroke","currentColor")},m(s,n){H(s,e,n),a(e,t)},d(s){s&&o(e)}}}function Te(l){let e,t,s,n,u,c,_,b,f=(l[1]?l[1].charAt(0).toUpperCase():"用")+"",k,i,E,F,m=(l[1]||"用户")+"",M,B,p,V,L,T,z,R="个人设置",P,J,W="退出登录",Y,q,K=me(l[3]),O=[];for(let A=0;A<K.length;A+=1)O[A]=Se(Ne(l,K,A));return{c(){e=d("div"),t=d("div");for(let A=0;A<O.length;A+=1)O[A].c();s=I(),n=d("div"),u=d("div"),c=d("div"),_=d("div"),b=d("span"),k=Z(f),i=I(),E=d("div"),F=d("div"),M=Z(m),B=I(),p=d("div"),V=Z(l[0]),L=I(),T=d("div"),z=d("a"),z.textContent=R,P=I(),J=d("button"),J.textContent=W,this.h()},l(A){e=h(A,"DIV",{class:!0});var G=v(e);t=h(G,"DIV",{class:!0});var C=v(t);for(let j=0;j<O.length;j+=1)O[j].l(C);C.forEach(o),s=N(G),n=h(G,"DIV",{class:!0});var w=v(n);u=h(w,"DIV",{class:!0});var D=v(u);c=h(D,"DIV",{class:!0});var ae=v(c);_=h(ae,"DIV",{class:!0});var $=v(_);b=h($,"SPAN",{class:!0});var U=v(b);k=Q(U,f),U.forEach(o),$.forEach(o),ae.forEach(o),i=N(D),E=h(D,"DIV",{class:!0});var g=v(E);F=h(g,"DIV",{class:!0});var x=v(F);M=Q(x,m),x.forEach(o),B=N(g),p=h(g,"DIV",{class:!0});var y=v(p);V=Q(y,l[0]),y.forEach(o),g.forEach(o),D.forEach(o),L=N(w),T=h(w,"DIV",{class:!0});var S=v(T);z=h(S,"A",{href:!0,class:!0,"data-svelte-h":!0}),te(z)!=="svelte-ak432w"&&(z.textContent=R),P=N(S),J=h(S,"BUTTON",{class:!0,"data-svelte-h":!0}),te(J)!=="svelte-87imc"&&(J.textContent=W),S.forEach(o),w.forEach(o),G.forEach(o),this.h()},h(){r(t,"class","pt-2 pb-3 space-y-1"),r(b,"class","text-sm font-medium text-gray-700"),r(_,"class","h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center"),r(c,"class","flex-shrink-0"),r(F,"class","text-base font-medium text-gray-800"),r(p,"class","text-sm font-medium text-gray-500 capitalize"),r(E,"class","ml-3"),r(u,"class","flex items-center px-4"),r(z,"href","/profile"),r(z,"class","block px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50"),r(J,"class","block w-full text-left px-4 py-2 text-base font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50"),r(T,"class","mt-3 space-y-1"),r(n,"class","pt-4 pb-3 border-t border-gray-200"),r(e,"class","sm:hidden")},m(A,G){H(A,e,G),a(e,t);for(let C=0;C<O.length;C+=1)O[C]&&O[C].m(t,null);a(e,s),a(e,n),a(n,u),a(u,c),a(c,_),a(_,b),a(b,k),a(u,i),a(u,E),a(E,F),a(F,M),a(E,B),a(E,p),a(p,V),a(n,L),a(n,T),a(T,z),a(T,P),a(T,J),Y||(q=se(J,"click",He),Y=!0)},p(A,G){if(G&8){K=me(A[3]);let C;for(C=0;C<K.length;C+=1){const w=Ne(A,K,C);O[C]?O[C].p(w,G):(O[C]=Se(w),O[C].c(),O[C].m(t,null))}for(;C<O.length;C+=1)O[C].d(1);O.length=K.length}G&2&&f!==(f=(A[1]?A[1].charAt(0).toUpperCase():"用")+"")&&X(k,f),G&2&&m!==(m=(A[1]||"用户")+"")&&X(M,m),G&1&&X(V,A[0])},d(A){A&&o(e),Pe(O,A),Y=!1,q()}}}function Se(l){let e,t,s=l[6].icon+"",n,u,c=l[6].name+"",_,b,f;return{c(){e=d("a"),t=d("span"),n=Z(s),u=I(),_=Z(c),b=I(),this.h()},l(k){e=h(k,"A",{href:!0,class:!0});var i=v(e);t=h(i,"SPAN",{class:!0});var E=v(t);n=Q(E,s),E.forEach(o),u=N(i),_=Q(i,c),b=N(i),i.forEach(o),this.h()},h(){r(t,"class","mr-2"),r(e,"href",f=l[6].href),r(e,"class","block pl-3 pr-4 py-2 text-base font-medium text-gray-500 hover:text-gray-700 hover:bg-gray-50")},m(k,i){H(k,e,i),a(e,t),a(t,n),a(e,u),a(e,_),a(e,b)},p(k,i){i&8&&s!==(s=k[6].icon+"")&&X(n,s),i&8&&c!==(c=k[6].name+"")&&X(_,c),i&8&&f!==(f=k[6].href)&&r(e,"href",f)},d(k){k&&o(e)}}}function je(l){let e,t,s;return{c(){e=d("div"),this.h()},l(n){e=h(n,"DIV",{class:!0,role:!0,tabindex:!0}),v(e).forEach(o),this.h()},h(){r(e,"class","fixed inset-0 z-40"),r(e,"role","button"),r(e,"tabindex","0")},m(n,u){H(n,e,u),t||(s=[se(e,"click",l[4]),se(e,"keydown",l[5])],t=!0)},p:ie,d(n){n&&o(e),t=!1,be(s)}}}function et(l){let e,t,s,n,u,c='<div class="h-8 w-8 rounded-full bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center"><span class="text-sm font-bold text-white">百</span></div> <span class="ml-2 text-xl font-semibold text-gray-900">百刀会</span>',_,b,f,k,i,E,F,m="打开用户菜单",M,B,p,V=(l[1]?l[1].charAt(0).toUpperCase():"用")+"",L,T,z,R,P,J,W="打开主菜单",Y,q,K,O,A,G,C=me(l[3]),w=[];for(let y=0;y<C.length;y+=1)w[y]=Ve(Ae(l,C,y));let D=l[2]&&Oe(l);function ae(y,S){return y[2]?Ye:$e}let $=ae(l),U=$(l),g=l[2]&&Te(l),x=l[2]&&je(l);return{c(){e=d("nav"),t=d("div"),s=d("div"),n=d("div"),u=d("div"),u.innerHTML=c,_=I(),b=d("div");for(let y=0;y<w.length;y+=1)w[y].c();f=I(),k=d("div"),i=d("div"),E=d("button"),F=d("span"),F.textContent=m,M=I(),B=d("div"),p=d("span"),L=Z(V),T=I(),D&&D.c(),z=I(),R=d("div"),P=d("button"),J=d("span"),J.textContent=W,Y=I(),U.c(),q=I(),g&&g.c(),K=I(),x&&x.c(),O=he(),this.h()},l(y){e=h(y,"NAV",{class:!0});var S=v(e);t=h(S,"DIV",{class:!0});var j=v(t);s=h(j,"DIV",{class:!0});var ee=v(s);n=h(ee,"DIV",{class:!0});var le=v(n);u=h(le,"DIV",{class:!0,"data-svelte-h":!0}),te(u)!=="svelte-1iequqv"&&(u.innerHTML=c),_=N(le),b=h(le,"DIV",{class:!0});var re=v(b);for(let pe=0;pe<w.length;pe+=1)w[pe].l(re);re.forEach(o),le.forEach(o),f=N(ee),k=h(ee,"DIV",{class:!0});var fe=v(k);i=h(fe,"DIV",{class:!0});var ne=v(i);E=h(ne,"BUTTON",{type:!0,class:!0});var oe=v(E);F=h(oe,"SPAN",{class:!0,"data-svelte-h":!0}),te(F)!=="svelte-1pelpmi"&&(F.textContent=m),M=N(oe),B=h(oe,"DIV",{class:!0});var Ee=v(B);p=h(Ee,"SPAN",{class:!0});var we=v(p);L=Q(we,V),we.forEach(o),Ee.forEach(o),oe.forEach(o),T=N(ne),D&&D.l(ne),ne.forEach(o),fe.forEach(o),z=N(ee),R=h(ee,"DIV",{class:!0});var Fe=v(R);P=h(Fe,"BUTTON",{type:!0,class:!0});var de=v(P);J=h(de,"SPAN",{class:!0,"data-svelte-h":!0}),te(J)!=="svelte-wobng2"&&(J.textContent=W),Y=N(de),U.l(de),de.forEach(o),Fe.forEach(o),ee.forEach(o),j.forEach(o),q=N(S),g&&g.l(S),S.forEach(o),K=N(y),x&&x.l(y),O=he(),this.h()},h(){r(u,"class","flex-shrink-0 flex items-center"),r(b,"class","hidden sm:ml-6 sm:flex sm:space-x-8"),r(n,"class","flex"),r(F,"class","sr-only"),r(p,"class","text-sm font-medium text-gray-700"),r(B,"class","h-8 w-8 rounded-full bg-gray-300 flex items-center justify-center"),r(E,"type","button"),r(E,"class","bg-white rounded-full flex text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"),r(i,"class","relative"),r(k,"class","hidden sm:ml-6 sm:flex sm:items-center"),r(J,"class","sr-only"),r(P,"type","button"),r(P,"class","inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500"),r(R,"class","sm:hidden flex items-center"),r(s,"class","flex justify-between h-16"),r(t,"class","max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"),r(e,"class","bg-white shadow-sm border-b border-gray-200")},m(y,S){H(y,e,S),a(e,t),a(t,s),a(s,n),a(n,u),a(n,_),a(n,b);for(let j=0;j<w.length;j+=1)w[j]&&w[j].m(b,null);a(s,f),a(s,k),a(k,i),a(i,E),a(E,F),a(E,M),a(E,B),a(B,p),a(p,L),a(i,T),D&&D.m(i,null),a(s,z),a(s,R),a(R,P),a(P,J),a(P,Y),U.m(P,null),a(e,q),g&&g.m(e,null),H(y,K,S),x&&x.m(y,S),H(y,O,S),A||(G=[se(E,"click",l[4]),se(P,"click",l[4])],A=!0)},p(y,[S]){if(S&8){C=me(y[3]);let j;for(j=0;j<C.length;j+=1){const ee=Ae(y,C,j);w[j]?w[j].p(ee,S):(w[j]=Ve(ee),w[j].c(),w[j].m(b,null))}for(;j<w.length;j+=1)w[j].d(1);w.length=C.length}S&2&&V!==(V=(y[1]?y[1].charAt(0).toUpperCase():"用")+"")&&X(L,V),y[2]?D?D.p(y,S):(D=Oe(y),D.c(),D.m(i,null)):D&&(D.d(1),D=null),$!==($=ae(y))&&(U.d(1),U=$(y),U&&(U.c(),U.m(P,null))),y[2]?g?g.p(y,S):(g=Te(y),g.c(),g.m(e,null)):g&&(g.d(1),g=null),y[2]?x?x.p(y,S):(x=je(y),x.c(),x.m(O.parentNode,O)):x&&(x.d(1),x=null)},i:ie,o:ie,d(y){y&&(o(e),o(K),o(O)),Pe(w,y),D&&D.d(),U.d(),g&&g.d(),x&&x.d(y),A=!1,be(G)}}}function tt(l){const e=[{name:"私信",href:"/chat",icon:"💬"},{name:"算命",href:"/fortune",icon:"🔮"},{name:"带货",href:"/shop",icon:"🛍️"},{name:"个人",href:"/profile",icon:"👤"}];return l==="master"||l==="firstmate"?[...e,{name:"邀请链接",href:"/invite",icon:"🔗"},{name:"算命开关",href:"/fortune/settings",icon:"⚙️"}]:e}function He(){window.location.assign("https://baiduohui.com")}function st(l,e,t){let s,{userRole:n="fan"}=e,{userName:u=""}=e,c=!1;function _(){t(2,c=!c)}const b=f=>f.key==="Escape"&&_();return l.$$set=f=>{"userRole"in f&&t(0,n=f.userRole),"userName"in f&&t(1,u=f.userName)},l.$$.update=()=>{l.$$.dirty&1&&t(3,s=tt(n))},[n,u,c,s,_,b]}class lt extends ke{constructor(e){super(),ye(this,e,st,et,ge,{userRole:0,userName:1})}}function Me(l){let e,t,s,n,u=l[1]?"修改昵称":"设置昵称",c,_,b,f=l[1]?"您可以修改您的昵称":"请设置您的昵称以继续使用",k,i,E,F,m,M="昵称",B,p,V,L,T,z,R,P='<h4 class="text-sm font-medium text-blue-900 mb-1">昵称规则</h4> <ul class="text-sm text-blue-700 space-y-1"><li>• 长度：2-20个字符</li> <li>• 格式：仅支持中文、英文字母和emoji</li> <li>• 唯一性：不能与其他用户重复</li></ul>',J,W,Y,q,K,O,A;function G(g,x){if(g[3])return at;if(g[5])return nt;if(g[6])return rt}let C=G(l),w=C&&C(l),D=l[1]&&Ue(l);function ae(g,x){return g[4]?ot:it}let $=ae(l),U=$(l);return{c(){e=d("div"),t=d("div"),s=d("div"),n=d("h3"),c=Z(u),_=I(),b=d("p"),k=Z(f),i=I(),E=d("div"),F=d("div"),m=d("label"),m.textContent=M,B=I(),p=d("input"),L=I(),T=d("div"),w&&w.c(),z=I(),R=d("div"),R.innerHTML=P,J=I(),W=d("div"),D&&D.c(),Y=I(),q=d("button"),U.c(),this.h()},l(g){e=h(g,"DIV",{class:!0});var x=v(e);t=h(x,"DIV",{class:!0});var y=v(t);s=h(y,"DIV",{class:!0});var S=v(s);n=h(S,"H3",{class:!0});var j=v(n);c=Q(j,u),j.forEach(o),_=N(S),b=h(S,"P",{class:!0});var ee=v(b);k=Q(ee,f),ee.forEach(o),S.forEach(o),i=N(y),E=h(y,"DIV",{class:!0});var le=v(E);F=h(le,"DIV",{class:!0});var re=v(F);m=h(re,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),te(m)!=="svelte-1jvocfx"&&(m.textContent=M),B=N(re),p=h(re,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0,maxlength:!0}),L=N(re),T=h(re,"DIV",{class:!0});var fe=v(T);w&&w.l(fe),fe.forEach(o),re.forEach(o),z=N(le),R=h(le,"DIV",{class:!0,"data-svelte-h":!0}),te(R)!=="svelte-1szhm8"&&(R.innerHTML=P),le.forEach(o),J=N(y),W=h(y,"DIV",{class:!0});var ne=v(W);D&&D.l(ne),Y=N(ne),q=h(ne,"BUTTON",{type:!0,class:!0});var oe=v(q);U.l(oe),oe.forEach(o),ne.forEach(o),y.forEach(o),x.forEach(o),this.h()},h(){r(n,"class","text-lg font-semibold text-gray-900"),r(b,"class","mt-1 text-sm text-gray-600"),r(s,"class","px-6 py-4 border-b border-gray-200"),r(m,"for","nickname"),r(m,"class","block text-sm font-medium text-gray-700 mb-2"),r(p,"id","nickname"),r(p,"type","text"),r(p,"placeholder","请输入昵称（中文、英文、emoji）"),r(p,"class",V="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 "+(l[5]?"border-red-300":"")),r(p,"maxlength","20"),r(T,"class","mt-2 min-h-[1.25rem]"),r(F,"class","mb-4"),r(R,"class","bg-blue-50 rounded-md p-3 mb-4"),r(E,"class","px-6 py-4"),r(q,"type","button"),q.disabled=K=!!l[5]||l[3]||l[4]||!l[2].trim(),r(q,"class","px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed"),r(W,"class","px-6 py-4 border-t border-gray-200 flex justify-end space-x-3"),r(t,"class","bg-white rounded-lg shadow-xl max-w-md w-full"),r(e,"class","fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50")},m(g,x){H(g,e,x),a(e,t),a(t,s),a(s,n),a(n,c),a(s,_),a(s,b),a(b,k),a(t,i),a(t,E),a(E,F),a(F,m),a(F,B),a(F,p),De(p,l[2]),a(F,L),a(F,T),w&&w.m(T,null),a(E,z),a(E,R),a(t,J),a(t,W),D&&D.m(W,null),a(W,Y),a(W,q),U.m(q,null),O||(A=[se(p,"input",l[10]),se(p,"keydown",l[9]),se(q,"click",l[7])],O=!0)},p(g,x){x&2&&u!==(u=g[1]?"修改昵称":"设置昵称")&&X(c,u),x&2&&f!==(f=g[1]?"您可以修改您的昵称":"请设置您的昵称以继续使用")&&X(k,f),x&32&&V!==(V="block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 "+(g[5]?"border-red-300":""))&&r(p,"class",V),x&4&&p.value!==g[2]&&De(p,g[2]),C===(C=G(g))&&w?w.p(g,x):(w&&w.d(1),w=C&&C(g),w&&(w.c(),w.m(T,null))),g[1]?D?D.p(g,x):(D=Ue(g),D.c(),D.m(W,Y)):D&&(D.d(1),D=null),$===($=ae(g))&&U?U.p(g,x):(U.d(1),U=$(g),U&&(U.c(),U.m(q,null))),x&60&&K!==(K=!!g[5]||g[3]||g[4]||!g[2].trim())&&(q.disabled=K)},d(g){g&&o(e),w&&w.d(),D&&D.d(),U.d(),O=!1,be(A)}}}function rt(l){let e,t;return{c(){e=d("p"),t=Z(l[6]),this.h()},l(s){e=h(s,"P",{class:!0});var n=v(e);t=Q(n,l[6]),n.forEach(o),this.h()},h(){r(e,"class","text-sm text-green-600")},m(s,n){H(s,e,n),a(e,t)},p(s,n){n&64&&X(t,s[6])},d(s){s&&o(e)}}}function nt(l){let e,t;return{c(){e=d("p"),t=Z(l[5]),this.h()},l(s){e=h(s,"P",{class:!0});var n=v(e);t=Q(n,l[5]),n.forEach(o),this.h()},h(){r(e,"class","text-sm text-red-600")},m(s,n){H(s,e,n),a(e,t)},p(s,n){n&32&&X(t,s[5])},d(s){s&&o(e)}}}function at(l){let e,t=`<svg class="animate-spin -ml-1 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                验证中...`;return{c(){e=d("div"),e.innerHTML=t,this.h()},l(s){e=h(s,"DIV",{class:!0,"data-svelte-h":!0}),te(e)!=="svelte-1964u8b"&&(e.innerHTML=t),this.h()},h(){r(e,"class","flex items-center text-sm text-gray-500")},m(s,n){H(s,e,n)},p:ie,d(s){s&&o(e)}}}function Ue(l){let e,t="取消",s,n;return{c(){e=d("button"),e.textContent=t,this.h()},l(u){e=h(u,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),te(e)!=="svelte-1szimb6"&&(e.textContent=t),this.h()},h(){r(e,"type","button"),r(e,"class","px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2")},m(u,c){H(u,e,c),s||(n=se(e,"click",l[8]),s=!0)},p:ie,d(u){u&&o(e),s=!1,n()}}}function it(l){let e=l[1]?"更新昵称":"设置昵称",t;return{c(){t=Z(e)},l(s){t=Q(s,e)},m(s,n){H(s,t,n)},p(s,n){n&2&&e!==(e=s[1]?"更新昵称":"设置昵称")&&X(t,e)},d(s){s&&o(t)}}}function ot(l){let e,t,s,n;return{c(){e=ue("svg"),t=ue("circle"),s=ue("path"),n=Z(`
            提交中...`),this.h()},l(u){e=ce(u,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var c=v(e);t=ce(c,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),v(t).forEach(o),s=ce(c,"path",{class:!0,fill:!0,d:!0}),v(s).forEach(o),c.forEach(o),n=Q(u,`
            提交中...`),this.h()},h(){r(t,"class","opacity-25"),r(t,"cx","12"),r(t,"cy","12"),r(t,"r","10"),r(t,"stroke","currentColor"),r(t,"stroke-width","4"),r(s,"class","opacity-75"),r(s,"fill","currentColor"),r(s,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),r(e,"class","animate-spin -ml-1 mr-2 h-4 w-4"),r(e,"xmlns","http://www.w3.org/2000/svg"),r(e,"fill","none"),r(e,"viewBox","0 0 24 24")},m(u,c){H(u,e,c),a(e,t),a(e,s),H(u,n,c)},p:ie,d(u){u&&(o(e),o(n))}}}function ut(l){let e,t=l[0]&&Me(l);return{c(){t&&t.c(),e=he()},l(s){t&&t.l(s),e=he()},m(s,n){t&&t.m(s,n),H(s,e,n)},p(s,[n]){s[0]?t?t.p(s,n):(t=Me(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ie,o:ie,d(s){s&&o(e),t&&t.d(s)}}}const ct=/^[\u4e00-\u9fa5a-zA-Z\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F1E0}-\u{1F1FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]+$/u;function ze(){return localStorage.getItem("supabase.auth.token")||""}function ft(l,e,t){const s=Le();let{isOpen:n=!1}=e,{currentNickname:u=""}=e,c=u,_=!1,b=!1,f="",k="";function i(){if(t(5,f=""),t(6,k=""),!c.trim()){t(5,f="昵称不能为空");return}if(c.length<2){t(5,f="昵称至少需要2个字符");return}if(c.length>20){t(5,f="昵称不能超过20个字符");return}if(!ct.test(c)){t(5,f="昵称只能包含中文、英文字母和emoji");return}c!==u&&E()}async function E(){if(!_)try{t(3,_=!0);const p=await fetch("/api/profile/validate_nickname",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ze()}`},body:JSON.stringify({nickname:c})}),V=await p.json();p.ok?t(6,k="昵称可用"):p.status===409?t(5,f="昵称已被占用，请选择其他昵称"):t(5,f=V.message||"验证失败，请重试")}catch(p){console.error("昵称验证失败:",p),t(5,f="网络错误，请重试")}finally{t(3,_=!1)}}async function F(){if(!(f||b||_))try{t(4,b=!0);const p=await fetch("/api/profile/update_nickname",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${ze()}`},body:JSON.stringify({nickname:c})});if(!p.ok){const V=await p.json();t(5,f=V.message||"更新失败，请重试");return}s("nicknameUpdated",{nickname:c}),m()}catch(p){console.error("更新昵称失败:",p),t(5,f="网络错误，请重试")}finally{t(4,b=!1)}}function m(){!u&&!c.trim()||(t(0,n=!1),s("close"))}function M(p){p.key==="Enter"&&!f&&!_&&!b&&F(),p.key==="Escape"&&m()}function B(){c=this.value,t(2,c)}return l.$$set=p=>{"isOpen"in p&&t(0,n=p.isOpen),"currentNickname"in p&&t(1,u=p.currentNickname)},l.$$.update=()=>{l.$$.dirty&4&&c&&i()},[n,u,c,_,b,f,k,F,m,M,B]}class dt extends ke{constructor(e){super(),ye(this,e,ft,ut,ge,{isOpen:0,currentNickname:1})}}function ht(l){let e,t,s,n,u,c,_,b,f;s=new lt({props:{userRole:mt,userName:l[0]}});const k=l[4].default,i=Re(k,l,l[3],null);function E(m){l[5](m)}let F={currentNickname:l[0]};return l[1]!==void 0&&(F.isOpen=l[1]),_=new dt({props:F}),Je.push(()=>Xe(_,"isOpen",E)),_.$on("nicknameUpdated",l[2]),_.$on("close",l[6]),{c(){e=I(),t=d("div"),xe(s.$$.fragment),n=I(),u=d("main"),i&&i.c(),c=I(),xe(_.$$.fragment),this.h()},l(m){qe("svelte-tcxiz7",document.head).forEach(o),e=N(m),t=h(m,"DIV",{class:!0});var B=v(t);Ce(s.$$.fragment,B),n=N(B),u=h(B,"MAIN",{});var p=v(u);i&&i.l(p),p.forEach(o),c=N(B),Ce(_.$$.fragment,B),B.forEach(o),this.h()},h(){document.title="百刀会 - Fan",r(t,"class","min-h-screen bg-gray-50")},m(m,M){H(m,e,M),H(m,t,M),Be(s,t,null),a(t,n),a(t,u),i&&i.m(u,null),a(t,c),Be(_,t,null),f=!0},p(m,[M]){const B={};M&1&&(B.userName=m[0]),s.$set(B),i&&i.p&&(!f||M&8)&&Ge(i,k,m,m[3],f?Ze(k,m[3],M,null):Ke(m[3]),null);const p={};M&1&&(p.currentNickname=m[0]),!b&&M&2&&(b=!0,p.isOpen=m[1],Qe(()=>b=!1)),_.$set(p)},i(m){f||(ve(s.$$.fragment,m),ve(i,m),ve(_.$$.fragment,m),f=!0)},o(m){_e(s.$$.fragment,m),_e(i,m),_e(_.$$.fragment,m),f=!1},d(m){m&&(o(e),o(t)),Ie(s),i&&i.d(m),Ie(_)}}}let mt="fan";function pt(l,e,t){let{$$slots:s={},$$scope:n}=e,u="",c=!1;We(()=>{_()});async function _(){try{const i=localStorage.getItem("currentUser");if(i){const E=JSON.parse(i);t(0,u=E.nickname||""),u||t(1,c=!0)}}catch(i){console.error("检查用户信息失败:",i)}}function b(i){t(0,u=i.detail.nickname);const E=localStorage.getItem("currentUser");if(E){const F=JSON.parse(E);F.nickname=u,localStorage.setItem("currentUser",JSON.stringify(F))}}function f(i){c=i,t(1,c)}const k=()=>t(1,c=!1);return l.$$set=i=>{"$$scope"in i&&t(3,n=i.$$scope)},[u,c,b,n,s,f,k]}class gt extends ke{constructor(e){super(),ye(this,e,pt,ht,ge,{})}}export{gt as component};

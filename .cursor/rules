


# ç™¾åˆ€ä¼šå­ç›®å½•æ¶æ„è¿ç§» - Cursor å¼€å‘è§„åˆ™

## ğŸ¯ è¿ç§»ç›®æ ‡
å°†å½“å‰çš„å­åŸŸåæ¶æ„ï¼ˆfan.baidaohui.comï¼‰è¿ç§»åˆ°å­ç›®å½•æ¶æ„ï¼ˆbaidaohui.com/fanï¼‰ï¼Œä¼˜åŒ–éƒ¨ç½²å’Œå¼€å‘ä½“éªŒã€‚

## ğŸ“ é¡¹ç›®ç»“æ„çº¦å®š

### å‰ç«¯è·¯ç”±ç»“æ„ï¼ˆæ–°ï¼‰
```
src/routes/
â”œâ”€â”€ +page.svelte              # ä¸»é¡µï¼šè§’è‰²é€‰æ‹©æˆ–æ™ºèƒ½é‡å®šå‘
â”œâ”€â”€ +layout.svelte            # å…¨å±€å¸ƒå±€ï¼šå¯¼èˆªã€è®¤è¯æ£€æŸ¥
â”œâ”€â”€ login/
â”‚   â”œâ”€â”€ +page.svelte         # ç™»å½•é¡µé¢
â”‚   â”œâ”€â”€ +page.server.ts      # ç™»å½•æœåŠ¡ç«¯é€»è¾‘
â”‚   â””â”€â”€ callback/
â”‚       â”œâ”€â”€ +page.svelte     # OAuthå›è°ƒé¡µé¢
â”‚       â””â”€â”€ +page.server.ts  # OAuthå›è°ƒå¤„ç†
â”œâ”€â”€ fan/+page.svelte          # Fanç”¨æˆ·ä¸»é¡µ
â”œâ”€â”€ member/+page.svelte       # Memberç”¨æˆ·ä¸»é¡µ
â”œâ”€â”€ master/+page.svelte       # Masterç”¨æˆ·ä¸»é¡µ
â”œâ”€â”€ firstmate/+page.svelte    # Firstmateç”¨æˆ·ä¸»é¡µ
â”œâ”€â”€ seller/+page.svelte       # Sellerç”¨æˆ·ä¸»é¡µ
â””â”€â”€ api/                      # APIä»£ç†è·¯ç”±
    â”œâ”€â”€ auth/
    â”œâ”€â”€ sso/
    â”œâ”€â”€ fortune/
    â”œâ”€â”€ chat/
    â”œâ”€â”€ ecommerce/
    â”œâ”€â”€ payment/
    â”œâ”€â”€ keys/
    â””â”€â”€ email/
```

## ğŸ” è®¤è¯å’Œæƒé™è§„åˆ™

### è·¯å¾„æƒé™æ˜ å°„
```typescript
const PATH_ROLE_MAPPING = {
  '/': 'any',           // ä¸»é¡µï¼šä»»ä½•ç”¨æˆ·
  '/login': 'guest',    // ç™»å½•ï¼šæœªç™»å½•ç”¨æˆ·
  '/fan': 'fan',        // Fané¡µé¢ï¼šfanè§’è‰²
  '/member': 'member',  // Memberé¡µé¢ï¼šmemberè§’è‰²
  '/master': 'master',  // Masteré¡µé¢ï¼šmasterè§’è‰²
  '/firstmate': 'firstmate', // Firstmateé¡µé¢ï¼šfirstmateè§’è‰²
  '/seller': 'seller'   // Selleré¡µé¢ï¼šsellerè§’è‰²
};
```

### è®¤è¯æ£€æŸ¥é€»è¾‘
1. **é¡µé¢åŠ è½½æ—¶**ï¼šæ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦åŒ¹é…å½“å‰è·¯å¾„
2. **æƒé™ä¸åŒ¹é…**ï¼šé‡å®šå‘åˆ°æ­£ç¡®çš„è§’è‰²é¡µé¢æˆ–ç™»å½•é¡µ
3. **æœªç™»å½•ç”¨æˆ·**ï¼šé‡å®šå‘åˆ°`/login`é¡µé¢
4. **ç™»å½•ç”¨æˆ·è®¿é—®ç™»å½•é¡µ**ï¼šé‡å®šå‘åˆ°å¯¹åº”è§’è‰²é¡µé¢

## ğŸ›£ï¸ è·¯ç”±å’Œé“¾æ¥è§„åˆ™

### å†…éƒ¨é“¾æ¥çº¦å®š
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„
<a href="/fan">Fané¡µé¢</a>
<a href="/master">Masteré¡µé¢</a>

// âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨å­åŸŸå
<a href="https://fan.baidaohui.com">Fané¡µé¢</a>

// âœ… æ­£ç¡®ï¼šä½¿ç”¨SvelteKitçš„gotoå‡½æ•°
import { goto } from '$app/navigation';
goto('/member');

// âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨window.locationç›´æ¥è·³è½¬å­åŸŸå
window.location.href = 'https://member.baidaohui.com';
```

### APIè°ƒç”¨è§„èŒƒ
```typescript
// âœ… æ­£ç¡®ï¼šç»Ÿä¸€çš„APIè·¯å¾„
fetch('/api/fortune/list');
fetch('/api/chat/messages');
fetch('/api/keys/list');

// âŒ é”™è¯¯ï¼šä¸è¦ç¡¬ç¼–ç å­åŸŸå
fetch('https://master.baidaohui.com/api/keys/list');

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
const API_BASE = import.meta.env.VITE_API_BASE || '';
fetch(`${API_BASE}/api/fortune/list`);
```

## ğŸ¨ UI/UX å¼€å‘è§„åˆ™

### å¯¼èˆªç»„ä»¶
```svelte
<!-- âœ… æ­£ç¡®ï¼šè§’è‰²å¯¼èˆª -->
<nav class="role-nav">
  {#if userRole === 'fan'}
    <a href="/fan" class="nav-link">ç§ä¿¡</a>
    <a href="/fan#fortune" class="nav-link">ç®—å‘½</a>
  {:else if userRole === 'master'}
    <a href="/master" class="nav-link">é‚€è¯·é“¾æ¥</a>
    <a href="/master#fortune" class="nav-link">ç®—å‘½ç®¡ç†</a>
  {/if}
</nav>

<!-- âŒ é”™è¯¯ï¼šä¸è¦ä½¿ç”¨å­åŸŸåé“¾æ¥ -->
<a href="https://fan.baidaohui.com">ç§ä¿¡</a>
```

### å“åº”å¼è®¾è®¡
- ç§»åŠ¨ç«¯ä¼˜å…ˆè®¾è®¡
- ä½¿ç”¨TailwindCSSçš„å“åº”å¼ç±»
- ç¡®ä¿åœ¨æ‰€æœ‰è®¾å¤‡ä¸Šè·¯ç”±æ­£å¸¸å·¥ä½œ

## ğŸ”§ å¼€å‘é…ç½®è§„åˆ™

### ç¯å¢ƒå˜é‡ç®¡ç†
```bash
# å¼€å‘ç¯å¢ƒ (.env.local)
VITE_APP_BASE_URL=http://localhost:3000
VITE_API_BASE_URL=http://localhost:8080

# ç”Ÿäº§ç¯å¢ƒ
VITE_APP_BASE_URL=https://baidaohui.com
VITE_API_BASE_URL=https://baidaohui.com
```

### SvelteKité…ç½®
```javascript
// svelte.config.js
export default {
  kit: {
    adapter: adapter(),
    paths: {
      base: '', // ä½¿ç”¨æ ¹è·¯å¾„
    },
    trailingSlash: 'never', // ä¸ä½¿ç”¨å°¾éšæ–œæ 
    alias: {
      $lib: 'src/lib',
      $components: 'src/components'
    }
  }
};
```

## ğŸ§ª æµ‹è¯•è§„åˆ™

### è·¯ç”±æµ‹è¯•
```typescript
// æµ‹è¯•è·¯ç”±æƒé™
test('fanç”¨æˆ·è®¿é—®masteré¡µé¢åº”é‡å®šå‘', async () => {
  // æ¨¡æ‹Ÿfanç”¨æˆ·
  mockUser({ role: 'fan' });
  
  // è®¿é—®masteré¡µé¢
  await goto('/master');
  
  // åº”è¯¥é‡å®šå‘åˆ°fané¡µé¢
  expect(page.url().pathname).toBe('/fan');
});
```

### APIæµ‹è¯•
```typescript
// æµ‹è¯•APIè°ƒç”¨
test('APIè°ƒç”¨ä½¿ç”¨æ­£ç¡®è·¯å¾„', async () => {
  const response = await fetch('/api/fortune/list');
  expect(response.status).toBe(200);
});
```

## ğŸš¨ å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### é—®é¢˜1ï¼šå†…å­˜ä¸è¶³ï¼ˆå½“å‰é—®é¢˜ï¼‰
```bash
# ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šå¢åŠ Node.jså†…å­˜é™åˆ¶
node --max-old-space-size=8192 node_modules/.bin/vite dev

# é•¿æœŸè§£å†³æ–¹æ¡ˆï¼šä¼˜åŒ–ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
# åœ¨è·¯ç”±ç»„ä»¶ä¸­ä½¿ç”¨åŠ¨æ€å¯¼å…¥
const LazyComponent = () => import('./HeavyComponent.svelte');
```

### é—®é¢˜2ï¼šè·¯ç”±å†å²ç®¡ç†
```typescript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨SvelteKitçš„è·¯ç”±API
import { page } from '$app/stores';
import { goto } from '$app/navigation';

// æ£€æŸ¥å½“å‰è·¯å¾„
$page.url.pathname; // '/fan'

// ç¼–ç¨‹å¼å¯¼èˆª
goto('/member', { replaceState: true });
```

### é—®é¢˜3ï¼šCookieå’Œè®¤è¯
```typescript
// âœ… æ­£ç¡®ï¼šå•åŸŸåCookieé…ç½®
cookies.set('access_token', token, {
  domain: 'baidaohui.com', // å•åŸŸå
  path: '/',
  httpOnly: true,
  secure: true,
  sameSite: 'lax'
});
```

## ğŸ“‹ å¼€å‘æ£€æŸ¥æ¸…å•

### ä»£ç æäº¤å‰æ£€æŸ¥
- [ ] æ‰€æœ‰é“¾æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œæ— å­åŸŸåç¡¬ç¼–ç 
- [ ] APIè°ƒç”¨è·¯å¾„æ­£ç¡®ï¼Œä½¿ç”¨`/api/`å‰ç¼€
- [ ] è®¤è¯é€»è¾‘åŸºäºè·¯å¾„è€ŒéåŸŸå
- [ ] ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®
- [ ] å“åº”å¼è®¾è®¡åœ¨å„è®¾å¤‡æ­£å¸¸æ˜¾ç¤º
- [ ] è·¯ç”±æƒé™æµ‹è¯•é€šè¿‡
- [ ] æ— TypeScripté”™è¯¯
- [ ] ESLintå’ŒPrettieræ ¼å¼åŒ–é€šè¿‡

### åŠŸèƒ½æµ‹è¯•æ£€æŸ¥
- [ ] ç™»å½•æµç¨‹æ­£å¸¸
- [ ] è§’è‰²æƒé™æ­£ç¡®æ§åˆ¶
- [ ] é¡µé¢é—´å¯¼èˆªæ— è¯¯
- [ ] APIè°ƒç”¨æˆåŠŸ
- [ ] åˆ·æ–°é¡µé¢çŠ¶æ€ä¿æŒ
- [ ] æµè§ˆå™¨å‰è¿›åé€€æ­£å¸¸

## ğŸ”„ è¿ç§»ä¼˜å…ˆçº§

### P0ï¼ˆå¿…é¡»å®Œæˆï¼‰
1. è·¯ç”±ç»“æ„è°ƒæ•´
2. è®¤è¯é€»è¾‘æ›´æ–°
3. APIè·¯å¾„ä¿®å¤
4. åŸºæœ¬åŠŸèƒ½æµ‹è¯•

### P1ï¼ˆé‡è¦ï¼‰
1. å¯¼èˆªç»„ä»¶æ›´æ–°
2. é”™è¯¯é¡µé¢å¤„ç†
3. æ€§èƒ½ä¼˜åŒ–
4. ç”¨æˆ·ä½“éªŒæ”¹è¿›

### P2ï¼ˆå¯é€‰ï¼‰
1. SEOä¼˜åŒ–
2. PWAæ”¯æŒ
3. é«˜çº§ç¼“å­˜ç­–ç•¥
4. ç›‘æ§å’Œåˆ†æ

## ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ä»£ç åˆ†å‰²
```typescript
// âœ… æ­£ç¡®ï¼šè·¯ç”±çº§ä»£ç åˆ†å‰²
const routes = {
  '/fan': () => import('./routes/fan/+page.svelte'),
  '/member': () => import('./routes/member/+page.svelte'),
  '/master': () => import('./routes/master/+page.svelte')
};
```

### æ‡’åŠ è½½
```svelte
<!-- âœ… æ­£ç¡®ï¼šç»„ä»¶æ‡’åŠ è½½ -->
{#await import('./HeavyComponent.svelte') then { default: Component }}
  <Component />
{/await}
```

å› ä¸ºæœ¬åœ°æœ‰ä¸¤ä¸ªbranchï¼Œè€Œä½ ä½¿ç”¨git push origin HEAD:mainï¼Œå¯¼è‡´æ•°æ®æ²¡åŒæ­¥æˆåŠŸï¼Œç‰ˆæœ¬ç”šè‡³å›é€€äº†ï¼Œè¯·ä½ ä½¿ç”¨git push -u origin upgrade/svelte5:mainï¼Œç¡®ä¿ä¹‹å‰çš„ä¿®æ”¹éƒ½åŒæ­¥æˆåŠŸï¼Œç¡®ä¿nasæ‹‰å–æ­£å¸¸
ä½¿ç”¨ssh bgy@107.172.87.113 + â€œå‘½ä»¤â€æ¥åœ¨VPSä¸Šæ‰§è¡Œå‘½ä»¤ï¼Œä¹‹åä½¿ç”¨GitHubå®Œæˆæœ¬æœºæ•°æ®æ¨é€åˆ°åœ£ä½•å¡VPS



